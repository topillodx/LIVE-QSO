<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIVE QSOs</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#f0f4f8;
  color:#020617;
}

/* UTC */
#utc{
  background:#003087;
  color:white;
  text-align:center;
  font-size:1.2em;
  padding:8px;
}

/* Banner */
header img{
  width:100%;
  display:block;
}

/* Botones */
#userBar{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin:10px 0;
}
.user-btn{
  padding:8px 14px;
  background:#22c55e;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}
.user-btn:hover{ background:#16a34a }

/* Tabla */
.table-container{
  width:95%;
  margin:auto;
  overflow-x:auto;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.2);
  margin-top:10px;
}

.table-container{
  width: fit-content;        /* Ajusta al contenido */
  margin: 20px auto;         /* Centra en la p√°gina */
  overflow-x:auto;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.2);
}

#liveTable{
  border-collapse: collapse;
  font-size:1.5em;
  table-layout:auto;         /* Columnas seg√∫n texto */
}

/* Encabezado */
#liveTable th{
  padding:4px 6px;           /* Muy compacto */
  border:1px solid #cbd5e1;
  background:#2563eb;
  color:white;
  font-weight:bold;
  text-align:center;
  white-space:nowrap;        /* No saltos de l√≠nea */
}

/* Filas */
#liveTable tbody td{
  padding:2px 4px;           /* Casi pegado al texto */
  border:none;
  text-align:center;
  white-space:nowrap;        /* Mantiene todo en l√≠nea */
}


/* Resaltado √∫ltima fila si quieres */
.latest{
  background:#fef3c7 !important;
}

/* Anchos ajustados */
#liveTable th:nth-child(1){ width:80px; }   /* Call */
#liveTable th:nth-child(2){ width:40px; }   /* Band */
#liveTable th:nth-child(3){ width:60px; }   /* Frec */
#liveTable th:nth-child(4){ width:50px; }   /* Mode */
#liveTable th:nth-child(5){ width:40px; }   /* RST */
#liveTable th:nth-child(6){ width:90px; }   /* Fecha */
#liveTable th:nth-child(7){ width:70px; }   /* Hora */
</style>
</head>
<body>

<div id="utc"></div>

<header>
  <img src="img/liveqso.png">
</header>

<div id="userBar">
  <button class="user-btn" onclick="location.href='inicio.html'">üè† Inicio</button>
  <button class="user-btn" onclick="logout()">üö™ Salir</button>
</div>

<div class="table-container">
  <table id="liveTable">
    <thead>
  <tr>
  <th>Fecha</th>
  <th>Hora UTC</th>
  <th>Frec</th>
  <th>Mode</th>
  <th>Band</th>
  <th>RST</th>
  <th>Call</th>
</tr>

    </thead>
    <tbody>
      <!-- QSOs se cargar√°n aqu√≠ -->
    </tbody>
  </table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBy5xlIVPNcAoxMj9XEAPQg61emdI9KhnY",
  authDomain: "live-qso-local-9d479.firebaseapp.com",
  databaseURL: "https://live-qso-local-9d479-default-rtdb.firebaseio.com",
  projectId: "live-qso-local-9d479",
  storageBucket: "live-qso-local-9d479.firebasestorage.app",
  messagingSenderId: "575830304961",
  appId: "1:575830304961:web:68801041ca39a2eeec8c40"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Mostrar hora UTC en tiempo real
setInterval(()=>{
  const n = new Date();
  document.getElementById("utc").innerText =
    `Hora UTC: ${n.getUTCHours().toString().padStart(2,"0")}:${n.getUTCMinutes().toString().padStart(2,"0")}:${n.getUTCSeconds().toString().padStart(2,"0")} | Fecha: ${n.getUTCDate().toString().padStart(2,"0")}/${(n.getUTCMonth()+1).toString().padStart(2,"0")}/${n.getUTCFullYear()}`;
},1000);

// Cargar QSOs en tiempo real, √∫ltimo primero
function loadQSOs(){
  const tbody = document.querySelector("#liveTable tbody");
  db.ref("QSOs").limitToLast(50).on("value", snap=>{
    tbody.innerHTML = "";
    const qsos = [];
    snap.forEach(s=>{
      qsos.push(s.val());
    });
    // Ordenar por timestamp descendente (√∫ltimo arriba)
    qsos.sort((a,b)=> b.timestamp - a.timestamp);
    
    qsos.forEach(d=>{
      const call = d.indicativo || "--";
      const band = d.banda || "--";
      const freq = d.frecuencia || "--";
      const mode = d.modo || "--";
      const rst  = d.rst || "--";
      const timestamp = d.timestamp || Date.now();
      const dateObj = new Date(timestamp);
      
      const fecha = dateObj.getUTCDate().toString().padStart(2,"0") + "/" + 
                    (dateObj.getUTCMonth()+1).toString().padStart(2,"0") + "/" + 
                    dateObj.getUTCFullYear();
      const hora = dateObj.getUTCHours().toString().padStart(2,"0") + ":" +
                   dateObj.getUTCMinutes().toString().padStart(2,"0") + ":" +
                   dateObj.getUTCSeconds().toString().padStart(2,"0");
      
      const tr = document.createElement("tr");
     tr.innerHTML = `
  <td>${fecha}</td>
  <td>${hora}</td>
  <td>${freq}</td>
  <td>${mode}</td>
  <td>${band}</td>
  <td>${rst}</td>
  <td>${call}</td>
`;

      tr.classList.add("latest");
      tbody.appendChild(tr);
    });
  });
}

loadQSOs();
</script>

</body>
</html>
